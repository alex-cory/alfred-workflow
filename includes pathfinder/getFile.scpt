on getPath()	-- get path to frontmost document	set frontPath to (path to frontmost application as text)		try		tell application (frontPath)			try				set p to (path of document 1) -- preview uses this style			on error				set p to (do shell script "ruby -rcgi -e 'print CGI.unescape ARGV[0][7..-1]' " & quoted form of p)				if p starts with "localhost" then					set p to (file of document 1) -- keynote, pages uses this style				end if			end try		end tell		set p to POSIX path of p			on error				-- if all else fails try to get it through system events				tell application "System Events"			set theprocess to the first process whose frontmost is true			set thewindow to the value of attribute "AXFocusedWindow" of theprocess			set thefile to the value of attribute "AXDocument" of thewindow as string		end tell		tell application "System Events" to tell (process 1 where frontmost is true)			--	value of attribute "AXDocument" of window 1			--end tell						set p to result			set p to (do shell script "ruby -rcgi -e 'print CGI.unescape ARGV[0][9..-1]' " & quoted form of p)		end tell			end try		return pend getPathset p to getPath()-- get parent directorydo shell script "dirname " & quoted form of preturn p